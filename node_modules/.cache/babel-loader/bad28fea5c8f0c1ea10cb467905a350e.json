{"ast":null,"code":"import _regeneratorRuntime from\"/home/aslambeq/skills/my-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/aslambeq/skills/my-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"/home/aslambeq/skills/my-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _objectSpread from\"/home/aslambeq/skills/my-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{usersAPI}from'../api/api';import{updateObjectInArray}from'../utils/object-helpers';var FOLLOW='FOLLOW';var UNFOLLOW='UNFOLLOW';var SET_USERS='SET-USERS';var SET_CURRENT_PAGE='SET-CURRENT-PAGE';var SET_TOTAL_USERS_COUNT='SET-TOTAL-USERS-COUNT';var TOGGLE_IS_FETCHING='TOGGLE-IS-FETCHING';var TOGGLE_IS_FOLLOWING_PROGRESS='TOGGLE-IS-FOLLOWING-PROGRESS';var initialState={users:[],pageSize:10,totalUsersCount:0,currentPage:1,isFetching:true,followingInProgress:[]};var usersReducer=function usersReducer(){var state=arguments.length>0&&arguments[0]!==undefined?arguments[0]:initialState;var action=arguments.length>1?arguments[1]:undefined;switch(action.type){case FOLLOW:return _objectSpread(_objectSpread({},state),{},{users:updateObjectInArray(state.users,action.userId,'id',{followed:true})});case UNFOLLOW:return _objectSpread(_objectSpread({},state),{},{users:updateObjectInArray(state.users,action.userId,'id',{followed:false})});case SET_USERS:{return _objectSpread(_objectSpread({},state),{},{users:action.users});}case SET_CURRENT_PAGE:{return _objectSpread(_objectSpread({},state),{},{currentPage:action.currentPage});}case SET_TOTAL_USERS_COUNT:{return _objectSpread(_objectSpread({},state),{},{totalUsersCount:action.count});}case TOGGLE_IS_FETCHING:{return _objectSpread(_objectSpread({},state),{},{isFetching:action.isFetching});}case TOGGLE_IS_FOLLOWING_PROGRESS:{return _objectSpread(_objectSpread({},state),{},{followingInProgress:action.isFetching?[].concat(_toConsumableArray(state.followingInProgress),[action.userId]):state.followingInProgress.filter(function(id){return id!=action.userId;})});}default:return state;}};// action creators\nexport var followSuccessAC=function followSuccessAC(userId){return{type:FOLLOW,userId:userId};};export var unfollowSuccessAC=function unfollowSuccessAC(userId){return{type:UNFOLLOW,userId:userId};};export var setUsersAC=function setUsersAC(users){return{type:SET_USERS,users:users};};export var setCurrentPageAC=function setCurrentPageAC(currentPage){return{type:SET_CURRENT_PAGE,currentPage:currentPage};};// currentPage == currentPage: currentPage\nexport var setTotalUsersCountAC=function setTotalUsersCountAC(totalUsersCount){return{type:SET_TOTAL_USERS_COUNT,count:totalUsersCount};};export var toggleIsFetchingAC=function toggleIsFetchingAC(isFetching){return{type:TOGGLE_IS_FETCHING,isFetching:isFetching};};export var toggleFollowingProgressAC=function toggleFollowingProgressAC(isFetching,userId){return{type:TOGGLE_IS_FOLLOWING_PROGRESS,isFetching:isFetching,userId:userId};};// thunk creators\nexport var getUsersThunkCreator=function getUsersThunkCreator(requestedPage,pageSize){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch){var data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispatch(toggleIsFetchingAC(true));dispatch(setCurrentPageAC(requestedPage));_context.next=4;return usersAPI.getUsers(requestedPage,pageSize);case 4:data=_context.sent;dispatch(toggleIsFetchingAC(false));dispatch(setUsersAC(data.items));dispatch(setTotalUsersCountAC(data.totalCount));case 8:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();};var followFlow=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch,userId,apiMethod,actionCreator){var response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:dispatch(toggleFollowingProgressAC(true,userId));_context2.next=3;return apiMethod(userId);case 3:response=_context2.sent;if(response.data.resultCode==0){dispatch(actionCreator(userId));}dispatch(toggleFollowingProgressAC(false,userId));case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function followFlow(_x2,_x3,_x4,_x5){return _ref2.apply(this,arguments);};}();export var follow=function follow(userId){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){var apiMethod;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:apiMethod=usersAPI.follow.bind(usersAPI);followFlow(dispatch,userId,apiMethod,followSuccessAC);case 2:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x6){return _ref3.apply(this,arguments);};}();};export var unfollow=function unfollow(userId){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch){var apiMethod;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:apiMethod=usersAPI.unfollow.bind(usersAPI);followFlow(dispatch,userId,apiMethod,unfollowSuccessAC);case 2:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x7){return _ref4.apply(this,arguments);};}();};export default usersReducer;","map":{"version":3,"sources":["/home/aslambeq/skills/my-app/src/redux/users-reducer.js"],"names":["usersAPI","updateObjectInArray","FOLLOW","UNFOLLOW","SET_USERS","SET_CURRENT_PAGE","SET_TOTAL_USERS_COUNT","TOGGLE_IS_FETCHING","TOGGLE_IS_FOLLOWING_PROGRESS","initialState","users","pageSize","totalUsersCount","currentPage","isFetching","followingInProgress","usersReducer","state","action","type","userId","followed","count","filter","id","followSuccessAC","unfollowSuccessAC","setUsersAC","setCurrentPageAC","setTotalUsersCountAC","toggleIsFetchingAC","toggleFollowingProgressAC","getUsersThunkCreator","requestedPage","dispatch","getUsers","data","items","totalCount","followFlow","apiMethod","actionCreator","response","resultCode","follow","bind","unfollow"],"mappings":"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","sourcesContent":["import { usersAPI } from '../api/api'\r\nimport { updateObjectInArray } from '../utils/object-helpers'\r\n\r\nconst FOLLOW = 'FOLLOW'\r\nconst UNFOLLOW = 'UNFOLLOW'\r\nconst SET_USERS = 'SET-USERS'\r\nconst SET_CURRENT_PAGE = 'SET-CURRENT-PAGE'\r\nconst SET_TOTAL_USERS_COUNT = 'SET-TOTAL-USERS-COUNT'\r\nconst TOGGLE_IS_FETCHING = 'TOGGLE-IS-FETCHING'\r\nconst TOGGLE_IS_FOLLOWING_PROGRESS = 'TOGGLE-IS-FOLLOWING-PROGRESS'\r\n\r\nlet initialState = {\r\n    users: [],\r\n    pageSize: 10,\r\n    totalUsersCount: 0,\r\n    currentPage: 1,\r\n    isFetching: true,\r\n    followingInProgress: []\r\n}\r\n\r\nconst usersReducer = (state = initialState, action) => {\r\n    switch (action.type) {\r\n        case FOLLOW:\r\n            return {\r\n                ...state,\r\n                users: updateObjectInArray(state.users, action.userId, 'id', {followed: true})\r\n            }\r\n        case UNFOLLOW:\r\n            return {\r\n                ...state,\r\n                users: updateObjectInArray(state.users, action.userId, 'id', {followed: false})\r\n            }\r\n        case SET_USERS: {\r\n            return {\r\n                ...state,\r\n                users: action.users\r\n            }\r\n        }\r\n        case SET_CURRENT_PAGE: {\r\n            return {\r\n                ...state,\r\n                currentPage: action.currentPage\r\n            }\r\n        }\r\n        case SET_TOTAL_USERS_COUNT: {\r\n            return {\r\n                ...state,\r\n                totalUsersCount: action.count\r\n            }\r\n        }\r\n        case TOGGLE_IS_FETCHING: {\r\n            return {\r\n                ...state,\r\n                isFetching: action.isFetching\r\n            }\r\n        }\r\n        case TOGGLE_IS_FOLLOWING_PROGRESS: {\r\n            return {\r\n                ...state,\r\n                followingInProgress: action.isFetching\r\n                    ? [...state.followingInProgress, action.userId]\r\n                    : state.followingInProgress.filter((id) => id != action.userId)\r\n            }\r\n        }\r\n        default:\r\n            return state\r\n    }\r\n}\r\n\r\n// action creators\r\n\r\nexport const followSuccessAC = (userId) => ({ type: FOLLOW, userId })\r\nexport const unfollowSuccessAC = (userId) => ({ type: UNFOLLOW, userId })\r\nexport const setUsersAC = (users) => ({ type: SET_USERS, users })\r\nexport const setCurrentPageAC = (currentPage) => ({\r\n    type: SET_CURRENT_PAGE,\r\n    currentPage: currentPage\r\n}) // currentPage == currentPage: currentPage\r\nexport const setTotalUsersCountAC = (totalUsersCount) => ({\r\n    type: SET_TOTAL_USERS_COUNT,\r\n    count: totalUsersCount\r\n})\r\nexport const toggleIsFetchingAC = (isFetching) => ({ type: TOGGLE_IS_FETCHING, isFetching })\r\nexport const toggleFollowingProgressAC = (isFetching, userId) => ({\r\n    type: TOGGLE_IS_FOLLOWING_PROGRESS,\r\n    isFetching,\r\n    userId\r\n})\r\n\r\n// thunk creators\r\n\r\nexport const getUsersThunkCreator = (requestedPage, pageSize) => {\r\n    return async (dispatch) => {\r\n        dispatch(toggleIsFetchingAC(true))\r\n        dispatch(setCurrentPageAC(requestedPage))\r\n\r\n        const data = await usersAPI.getUsers(requestedPage, pageSize)\r\n        dispatch(toggleIsFetchingAC(false))\r\n        dispatch(setUsersAC(data.items))\r\n        dispatch(setTotalUsersCountAC(data.totalCount))\r\n    }\r\n}\r\n\r\nconst followFlow = async (dispatch, userId, apiMethod, actionCreator) => {\r\n    dispatch(toggleFollowingProgressAC(true, userId))\r\n\r\n    const response = await apiMethod(userId)\r\n    if (response.data.resultCode == 0) {\r\n        dispatch(actionCreator(userId))\r\n    }\r\n    dispatch(toggleFollowingProgressAC(false, userId))\r\n}\r\n\r\nexport const follow = (userId) => {\r\n    return async (dispatch) => {\r\n        let apiMethod = usersAPI.follow.bind(usersAPI)\r\n        followFlow(dispatch, userId, apiMethod, followSuccessAC)\r\n    }\r\n}\r\n\r\nexport const unfollow = (userId) => {\r\n    return async (dispatch) => {\r\n        let apiMethod = usersAPI.unfollow.bind(usersAPI)\r\n        followFlow(dispatch, userId, apiMethod, unfollowSuccessAC)\r\n    }\r\n}\r\n\r\nexport default usersReducer\r\n"]},"metadata":{},"sourceType":"module"}